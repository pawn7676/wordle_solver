<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Solver</title>
    <style>
        body { font-family: sans-serif; background: #121213; color: white; max-width: 600px; margin: auto; padding: 20px; }
        
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 24px; }

        .stats { 
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 12px; 
            background: #1a1a1b; 
            border-radius: 8px; 
            font-size: 14px; 
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        @media (min-width: 480px) { .stats { grid-template-columns: repeat(4, 1fr); } }
        .A { color: #6aaa64; } .O { color: #5dade2; } .X { color: #f1c40f; } .Z { color: #ff4d4d; }
        
        .settings { display: flex; align-items: center; gap: 10px; font-size: 12px; color: #818384; text-transform: uppercase; font-weight: bold; }
        .switch { position: relative; display: inline-block; width: 34px; height: 18px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #3a3a3c; transition: .4s; border-radius: 18px; }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #538d4e; }
        input:checked + .slider:before { transform: translateX(16px); }

        .input-container { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
        input[type="text"] { padding: 12px; font-size: 16px; border-radius: 4px; border: 1px solid #3a3a3c; background: #3a3a3c; color: white; width: 100%; box-sizing: border-box; }
        
        button { padding: 12px; font-size: 16px; border-radius: 4px; border: none; background: #538d4e; color: white; cursor: pointer; font-weight: bold; }
        #computeBtn { background: #2d5a88; }
        
        #output { background: #1a1a1b; padding: 15px; margin-top: 10px; border-radius: 8px; font-size: 14px; }
        
        /* Grid Layout for Word Rows and Headers */
        .word-row { 
            display: grid; 
            grid-template-columns: 40px 1fr 80px 60px; 
            gap: 10px; 
            align-items: center;
            padding: 4px 0;
            font-family: monospace;
        }
        .header-row-grid { 
            display: grid; 
            grid-template-columns: 40px 1fr 80px 60px; 
            gap: 10px; 
            font-weight: bold; 
            color: #818384; 
            text-transform: uppercase; 
            font-size: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #3a3a3c;
            margin-bottom: 8px;
        }

        hr { border: 0; height: 1px; background: #3a3a3c; margin: 15px 0; }
        .section-header { font-weight: bold; text-transform: uppercase; font-size: 15px; color: #818384; margin-bottom: 8px; display: block; }
    </style>
</head>
<body>
    <div class="header-row">
        <h1>Wordle Solver</h1>
        <div class="settings">
            <span>Exclude Past Answers</span>
            <label class="switch">
                <input type="checkbox" id="filterToggle" checked onchange="applyFilters()">
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <div class="stats" id="stats">
        <div class="A">ANS: <span id="answerCount">0</span></div>
        <div class="O">ORIG: <span id="originalCount">0</span></div>
        <div class="X">EXT: <span id="extendedCount">0</span></div>
        <div class="Z">ZERO: <span id="zeroChanceCount">0</span></div>
    </div>    

    <div class="input-container">
        <input type="text" id="guessInput" placeholder="Guess" maxlength="5">
        <input type="text" id="patternInput" placeholder="Pattern" maxlength="5">
        <button onclick="handleTurn()">Submit Turn</button>
        <button id="computeBtn" onclick="runFullAnalysis()">Compute Entropy</button>
    </div>
    <div id="output">Enter a guess or click 'Compute Entropy' to begin.</div>

    <script>
        class Word {
            constructor(wordString, category, date) {
                this.wordString = wordString;
                this.category = category;
                this.answerDate = date ? new Date(date) : null;
                this.entropy = 0;
            }
        }

        let allWords = [];
        let possibleAnswers = [];
        let moveHistory = [];
        const CURRENT_DATE = new Date("2026-02-21");

        async function init() {
            try {
                const response = await fetch('all_words.json');
                const data = await response.json();
                allWords = Object.entries(data).map(([word, info]) => {
                    return new Word(word, info.category, info.date);
                });
                applyFilters();
            } catch (e) {
                document.getElementById('output').innerText = "Error loading all_words.json.";
            }
        }

        function applyFilters() {
            const excludePastAnswers = document.getElementById('filterToggle').checked;
            let filtered = allWords;

            if (excludePastAnswers) {
                filtered = filtered.filter(w => w.category !== 'A');
            }

            for (let i = 0; i < moveHistory.length; i++) {
                const turn = moveHistory[i];
                const nextFiltered = filtered.filter(w => 
                    generateColorPattern(w.wordString, turn.guess) === turn.pattern
                );

                if (nextFiltered.length === 0) {
                    alert(`The pattern "${turn.pattern}" for "${turn.guess.toUpperCase()}" is not a valid color pattern.`);
                    moveHistory.pop();
                    return;
                }
                filtered = nextFiltered;
            }

            possibleAnswers = filtered;
            updateStats();
            
            if (moveHistory.length > 0) {
                renderTopWords(99);
            }
        }

        function generateColorPattern(answer, guess) {
            let answerArr = answer.split('');
            let guessArr = guess.split('');
            let pattern = Array(5).fill('b');
            let counts = {};
            for (let char of answerArr) { counts[char] = (counts[char] || 0) + 1; }
            for (let i = 0; i < 5; i++) {
                if (guessArr[i] === answerArr[i]) {
                    pattern[i] = 'g';
                    counts[guessArr[i]]--;
                }
            }
            for (let i = 0; i < 5; i++) {
                if (pattern[i] === 'b' && counts[guessArr[i]] > 0) {
                    pattern[i] = 'y';
                    counts[guessArr[i]]--;
                }
            }
            return pattern.join('');
        }

        function assignEntropy(likelyAnswers) {
            allWords.forEach(guess => {
                let patternMap = {};
                likelyAnswers.forEach(answer => {
                    let p = generateColorPattern(answer.wordString, guess.wordString);
                    patternMap[p] = (patternMap[p] || 0) + 1;
                });
                let entropy = 0;
                const total = likelyAnswers.length;
                for (let count of Object.values(patternMap)) {
                    let prob = count / total;
                    entropy -= prob * Math.log2(prob);
                }
                guess.entropy = entropy;
            });
        }

        function handleTurn() {
            const gInput = document.getElementById('guessInput');
            const guess = gInput.value.toLowerCase().trim();
            const pInput = document.getElementById('patternInput');
            const pattern = pInput.value.toLowerCase().trim();

            if (guess.length !== 5 || pattern.length !== 5) {
                alert("Please enter a 5-letter word and 5-letter color pattern.");
                return;
            }

            const validChars = /^[gyb]+$/;
            if (!validChars.test(pattern)) {
                alert("Invalid pattern! Use 'g', 'y', or 'b'.");
                return;
            }

            const guessExists = allWords.some(w => w.wordString === guess);
            if (!guessExists) {
                alert(`'${guess.toUpperCase()}' is not in the word list.`);
                return;
            }

            if (pattern === 'ggggg') {
                alert(`Solved! The answer is ${guess.toUpperCase()}.`);
                return;
            }

            moveHistory.push({ guess, pattern });
            applyFilters();

            gInput.value = '';
            pInput.value = '';
            gInput.focus();
            document.getElementById('computeBtn').style.display = 'none';
        }

        function updateStats() {
            const counts = { 'A': 0, 'O': 0, 'X': 0, 'Z': 0 };
            possibleAnswers.forEach(w => { if(counts.hasOwnProperty(w.category)) counts[w.category]++; });
            document.getElementById('answerCount').textContent = counts.A;
            document.getElementById('originalCount').textContent = counts.O;
            document.getElementById('extendedCount').textContent = counts.X;
            document.getElementById('zeroChanceCount').textContent = counts.Z;
        }

        function runFullAnalysis() {
            document.getElementById('computeBtn').style.display = 'none'; 
            document.getElementById('output').innerHTML = "<em>Computing...</em>";
            setTimeout(() => { renderTopWords(99); }, 50);
        }

        function getYearsSince(wordObj) {
            if (wordObj.category === 'A' && wordObj.answerDate) {
                const diffTime = Math.abs(CURRENT_DATE - wordObj.answerDate);
                const diffYears = diffTime / (1000 * 60 * 60 * 24 * 365.25);
                return diffYears.toFixed(1);
            }
            return "";
        }

        function getHeaderHtml() {
            return `
                <div class="header-row-grid">
                    <div>#</div>
                    <div>Word</div>
                    <div>Entropy</div>
                    <div>Years</div>
                </div>`;
        }

        function getWordRowHtml(w, index) {
            const rank = index !== null ? index + 1 : "-";
            const years = getYearsSince(w);
            return `
                <div class="word-row">
                    <div>${rank}</div>
                    <div class="${w.category}">${w.wordString.toUpperCase()}</div>
                    <div>${w.entropy.toFixed(2)}</div>
                    <div>${years}</div>
                </div>`;
        }

        function renderTopWords(num) {
            const likely = possibleAnswers.filter(w => ['O', 'X', 'A'].includes(w.category));
            const targets = likely.length > 0 ? likely : possibleAnswers;
            assignEntropy(targets);

            allWords.sort((a, b) => b.entropy - a.entropy);
            possibleAnswers.sort((a, b) => {
                if (a.category === 'Z' && b.category !== 'Z') return 1;
                if (a.category !== 'Z' && b.category === 'Z') return -1;
                return b.entropy - a.entropy;
            });

            const bestPossibleEntropy = possibleAnswers[0] ? possibleAnswers[0].entropy : 0;
            const maxEntropyWords = allWords.filter(w => w.entropy > bestPossibleEntropy + 0.01).slice(0, 5);

            let html = "";
            
            if (maxEntropyWords.length > 0) {
                html += "<span class='section-header'>Max Entropy</span>";
                html += getHeaderHtml();
                maxEntropyWords.forEach(w => {
                    html += getWordRowHtml(w, null);
                });
                html += "<hr>";
            }

            html += "<span class='section-header'>Possible Answers</span>";
            html += getHeaderHtml();
            possibleAnswers.slice(0, num).forEach((w, i) => {
                html += getWordRowHtml(w, i);
            });
            document.getElementById('output').innerHTML = html;
        }

        init();

        document.getElementById('guessInput').addEventListener('input', (e) => {
            if (e.target.value.length === 5) document.getElementById('patternInput').focus();
        });

        document.getElementById('patternInput').addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && e.target.value.length === 0) {
                e.preventDefault();
                document.getElementById('guessInput').focus();
            }
        });

        [document.getElementById('guessInput'), document.getElementById('patternInput')].forEach(el => {
            el.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleTurn(); });
        });
    </script>
</body>
</html>